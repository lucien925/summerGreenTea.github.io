<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> javascript-for-loop-vs-array-foreach · 淡夏的绿茶</title><meta name="description" content="javascript-for-loop-vs-array-foreach - summer"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/summerGreenTea" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">javascript-for-loop-vs-array-foreach</h1><div class="post-info">Aug 14, 2016</div><div class="post-content"><blockquote>
<p>原文链接<a href="http://thejsguy.com/2016/07/30/javascript-for-loop-vs-array-foreach.html?utm_source=javascriptweekly&amp;utm_medium=email" target="_blank" rel="external">The for Loop vs. forEach in JavaScript</a></p>
</blockquote>
<p>最初在看到这篇文章的时候是在<strong>JSweekly</strong>上，自己觉得是一篇不错的文章，于是还是用自己的渣渣的英文水平来翻译下。人生中第一次翻译英文文章，还请多多指教。</p>
<a id="more"></a>
<p>如果你是一个javascript新手，你可能想知道古典的<strong>for</strong>循环对比数组上的<strong>forEach()</strong>方法有什么不同。在这篇文章，我将会回顾它们的工作方式然后讨论为什么我会选择用它们其中的一个使用。</p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p>让我们看看标准<strong>for</strong>循环和<strong>forEach()</strong>方法的结构.</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(var <span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; <span class="number">3</span>; <span class="built_in">i</span>++) &#123;</div><div class="line">	console.log(i);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>for</strong>需要使用3个声明.第一个声明<code>var i = 0;</code>在循环开始之前执行.第二个声明<code>i &lt; 3</code>定义了在包含块里面的代码的运行条件.第三个声明是在每次循环结束后执行.这个循环的结果就是执行<code>console.log()</code>3次，结果依次是0,1和2.</p>
<p>下面，我们有个<strong>products</strong>的数组:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var products = [</div><div class="line">  &#123; <span class="string">name:</span> <span class="string">'Running shoes'</span>, <span class="string">price:</span> <span class="number">75</span> &#125;,</div><div class="line">  &#123; <span class="string">name:</span> <span class="string">'Golf shoes'</span>,    <span class="string">price:</span> <span class="number">85</span> &#125;,</div><div class="line">  &#123; <span class="string">name:</span> <span class="string">'Dress shoes'</span>,   <span class="string">price:</span> <span class="number">95</span> &#125;,</div><div class="line">  &#123; <span class="string">name:</span> <span class="string">'Walking shoes'</span>, <span class="string">price:</span> <span class="number">65</span> &#125;,</div><div class="line">  &#123; <span class="string">name:</span> <span class="string">'Sandals'</span>,       <span class="string">price:</span> <span class="number">55</span> &#125;</div><div class="line">];</div></pre></td></tr></table></figure>
<p>如果我们想要循环每个产品的信息，我们需要改变<strong>for</strong>循环的条件，然后使用<strong>i</strong>作为索引去获取到当前遍历的产品信息.</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(var <span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; products.<span class="built_in">length</span>; <span class="built_in">i</span>++) &#123;</div><div class="line">	console.log(products[i]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>数组的<strong>forEach()</strong>方法也可以被用来实现相同的事情:</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">products.forEach(<span class="function"><span class="keyword">function</span><span class="params">(product, index)</span></span> &#123;</div><div class="line">	console.<span class="built_in">log</span>(<span class="built_in">product</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>因为<strong>products</strong>是一个数组，它继承了所有在<strong>Array.prototype</strong>上面的方法，比如我们可以传递一个函数给被调用的<strong>Array.prototype.forEach()</strong>方法，这个函数在每次遍历执行的过程中，都会被传入遍历的<code>product</code>.</p>
<p>现在，我们来看看我为什么会选择他们其中的一个去使用.</p>
<h2 id="for-VS-forEach"><a href="#for-VS-forEach" class="headerlink" title="for VS forEach()"></a>for VS forEach()</h2><ol>
<li>使用forEach()会增加可阅读性<br><strong>for</strong>循环和<strong>forEach()</strong>方法都允许我们去循环一个数组，但是现在我将来说说我为什么在大多数的时间里都更加喜欢使用<strong>froEach()</strong>.在下面的例子中，每次遍历，<code>product</code>都会被传入回调函数中。我不需要去通过临时变量<code>i</code>例如<code>products[i]</code>来获取当前遍历的<code>product</code>.当你添加更多的代码的时候，即使这么做也不是很难去阅读代码，但会显得更加多余了。想象下如果你的for循环里面还有一个for循环，就像这样:</li>
</ol>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="built_in">var</span> i = <span class="number">0</span>; i &lt; products.<span class="built_in">length</span>; i++) &#123;</div><div class="line">  console.<span class="built_in">log</span>(products[i]);</div><div class="line">  <span class="keyword">for</span> (<span class="built_in">var</span> j = <span class="number">0</span>; j &lt; products[i].sizes.<span class="built_in">length</span>; j++) &#123;</div><div class="line">    console.<span class="built_in">log</span>(products[i].sizes[j]);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当你的操作不仅仅只是一个console.log()的时候，这个阅读起来会更加困难。</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="built_in">var</span> i = <span class="number">0</span>; i &lt; products.<span class="built_in">length</span>; i++) &#123;</div><div class="line">  <span class="built_in">var</span> <span class="built_in">product</span> = products[i];</div><div class="line">  console.<span class="built_in">log</span>(<span class="built_in">product</span>);</div><div class="line">  <span class="keyword">for</span> (<span class="built_in">var</span> j = <span class="number">0</span>; j &lt; <span class="built_in">product</span>.sizes.<span class="built_in">length</span>; j++) &#123;</div><div class="line">    <span class="built_in">var</span> size = <span class="built_in">product</span>.sizes[j];</div><div class="line">    console.<span class="built_in">log</span>(size);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>变量product和size几乎是没有帮助的，而且我也不喜欢i、j临时变量.现在我们通过下面的代码来比较下forEach()：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">products.forEach(<span class="function"><span class="keyword">function</span><span class="params">(product)</span></span> &#123;</div><div class="line">  <span class="built_in">product</span>.sizes.forEach(<span class="function"><span class="keyword">function</span><span class="params">(size)</span></span> &#123;</div><div class="line">    console.<span class="built_in">log</span>(<span class="built_in">size</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>这里不仅仅是少了几行代码，我们也不需要添加i、j等计数的临时变量.</p>
<ol>
<li>forEach()有更少的<code>off-by-one</code>错误</li>
</ol>
<p>Wikipedia对<code>off-by-one</code>的定义:</p>
<p>有一些方式可以产生<em>off-by-one</em>的错误，但是这里有一个简单的例子。</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (var <span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt;= products.<span class="built_in">length</span>; <span class="built_in">i</span>++) &#123;</div><div class="line">  console.log(products[i]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个for循环开起来不是和文章开头那么很像吗？这里有个很小的不同点。注意for循环的第二个语句，这里的条件语句现在包含的是&lt;=而不是=。作为一个结果，这个循环将会多跑一次。即使这是个很小的例子，但是如果你不注意的话，这些类型的错误就会发生。当使用forEach()方法时，你一点都不需要去考虑这个条件语句</p>
<ol>
<li>更早的跳出循环<br>有一个情节我选择for循环而不是forEach()方法就是我想更早的太哦出循环。想象下我有个很长的products列表，我想尽快的找到符合条件的结果，然后做一些操作。如果我使用forEach()，它将会在一些没有必要遍历的结果中去遍历单个product，当数组很长的情况下这可能会引起一些性能问题。而使用for循环，你就拥有了跳出或阻止循环的能力。例如:</li>
</ol>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">for (<span class="name">var</span> i = <span class="number">0</span><span class="comment">; i &lt; products.length; i++) &#123;</span></div><div class="line">  if (<span class="name">matchesSomeCriteria</span>(<span class="name">products</span>[i])) &#123;</div><div class="line">    doSomething()<span class="comment">;</span></div><div class="line">    break<span class="comment">;</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用break关键字，当我们找到了正在找的内容时，我们可以尽可能快的在持续遍历的过程中停止循环。这个在ES6中根本算不上什么，ES6有个新的数组方法可以帮我们做类似的操作。这个方法就是find()，我也鼓励你去使用它。然后，在写这篇文章的时间节点上，并不是所有浏览器都已经支持，所以你可能需要使用Babel这样的转换器或者价格polyfill。<br>总结<br>这篇文章并没有很详尽的列出你什么时候该使用for循环，反之亦然，但是我列举了很多我在使用它们其中一个的场景。有一件事情我没有提到的是性能。如果你看了for循环和forEach()的性能比较的话，for循环会更快一些。然而，很多时候，这种性能差异在你的应用当中几乎是体现不出来的，选择使用for循环而不是forEach()其实是一种<em>premature optimization(过早优化)</em>。反而，优化代码的可读性可以确保我们在长期的维护过程中更加容易一点。当使用forEach()的性能存在问题是，然后换成for循环再看看它是否有什么不同。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/08/03/study-plan/" class="next">下一篇</a></div><div data-thread-key="2016/08/14/javascript-for-loop-vs-array-foreach/" data-title="javascript-for-loop-vs-array-foreach" data-url="http://summerGreenTea.github.io/2016/08/14/javascript-for-loop-vs-array-foreach/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"yuhuan"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2016 <a href="http://summerGreenTea.github.io">summer</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>